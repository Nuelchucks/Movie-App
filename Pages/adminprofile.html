<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Fantasy2Reality</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body, html {
      height: 100%;
      margin: 0;
      font-family: 'Poppins', sans-serif;
      color: #ec1515;
      overflow-x: hidden;
    }

    /* Background Video */
    .bg-video {
      position: fixed;
      right: 0;
      bottom: 0;
      min-width: 100%;
      min-height: 100%;
      z-index: -1;
      filter: brightness(0.8);
      object-fit: cover;
    }

    /* Glassmorphism Cards */
    .glass-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(12px);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.5);
    }

    /* Stat Cards */
    .stat-card {
      transition: transform 0.3s ease;
      cursor: pointer;
    }
    .stat-card:hover {
      transform: translateY(-5px);
    }

    /* Tables */
    .table thead {
      background: rgba(236, 21, 21, 0.8);
      color: white;
    }

    /* Modal Glassmorphism */
    .modal-content {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(12px);
      border-radius: 15px;
      color: #fff;
    }
    .modal-header, .modal-footer {
      border: none;
    }
    .btn-glass {
      background: rgba(236, 21, 21, 0.8);
      border: none;
      color: white;
      border-radius: 8px;
      transition: 0.3s ease;
    }
    .btn-glass:hover {
      background: rgba(236, 21, 21, 1);
    }
  </style>
</head>
<body>
  <!-- Background Video -->
  <video autoplay muted loop class="bg-video">
    <source src="../Asset/Videos/mixkit-burning-lava-particles-leaping-through-the-air-4426-hd-ready.mp4" type="video/mp4">
  </video>

  <!-- Navbar -->
  <nav class="navbar navbar-dark bg-dark bg-opacity-75">
    <div class="container d-flex justify-content-between">
      <a class="navbar-brand" href="#">
        <img src="../Asset/Images/slazzer-preview-8zfsj.png" 
             width="100" height="70"
             style="filter: brightness(0) invert(1);">
      </a>
      <button id="logoutBtn" class="btn btn-outline-light btn-sm">Logout</button>
    </div>
  </nav>

  <div class="container py-5 text-light">
    <!-- Admin Welcome -->
    <div class="text-center mb-5">
      <h1 id="adminName">Admin Dashboard</h1>
      <p class="lead">Manage Movies, Users & Reports</p>
    </div>

    <!-- Stats -->
    <div class="row mb-5 text-center">
      <div class="col-md-3">
        <div class="glass-card stat-card">
          <h3 id="userCount">0</h3>
          <p>Registered Users</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="glass-card stat-card">
          <h3 id="movieCount">0</h3>
          <p>Total Movies</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="glass-card stat-card">
          <h3 id="reportsCount">0</h3>
          <p>Reports</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="glass-card stat-card">
          <h3 id="activeSessions">0</h3>
          <p>Active Sessions</p>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-4" id="dashboardTabs">
      <li class="nav-item">
        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#manageMovies">Manage Movies</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#manageUsers">Manage Users</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#reports">Reports</button>
      </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content">
      <!-- Manage Movies -->
      <div class="tab-pane fade show active" id="manageMovies">
        <div class="glass-card mb-4">
          <h4>All Movies</h4>
          <table class="table table-hover text-light">
            <thead>
              <tr>
                <th>#</th>
                <th>Title</th>
                <th>Poster</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="moviesTable">
              <!-- dynamic -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Manage Users -->
      <div class="tab-pane fade" id="manageUsers">
        <div class="glass-card mb-4">
          <h4>All Users</h4>
          <table class="table table-hover text-light">
            <thead>
              <tr>
                <th>#</th>
                <th>Username</th>
                <th>Email</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="usersTable">
              <!-- dynamic -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Reports -->
      <div class="tab-pane fade" id="reports">
        <div class="glass-card mb-4">
          <h4>User Reports</h4>
          <div id="reportsList">
            <p>No reports available yet.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Movie Edit Modal -->
  <div class="modal fade" id="editMovieModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5>Edit Movie</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <!-- Keep markup as-is (no ids) -->
          <input type="text" class="form-control mb-3" placeholder="Movie Title">
          <input type="text" class="form-control mb-3" placeholder="Poster URL">
          <textarea class="form-control" placeholder="Description"></textarea>
        </div>
        <div class="modal-footer">
          <button class="btn btn-glass" data-bs-dismiss="modal">Save Changes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Movie Delete Modal -->
  <div class="modal fade" id="deleteMovieModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content text-center">
        <div class="modal-header">
          <h5>Confirm Delete</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete this movie?</p>
        </div>
        <div class="modal-footer justify-content-center">
          <button class="btn btn-danger" data-bs-dismiss="modal">Yes, Delete</button>
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- User Edit Modal -->
  <div class="modal fade" id="editUserModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5>Edit User</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <!-- Keep markup as-is (no ids) -->
          <input type="text" class="form-control mb-3" placeholder="Username">
          <input type="email" class="form-control mb-3" placeholder="Email">
          <select class="form-select">
            <option>Active</option>
            <option>Suspended</option>
          </select>
        </div>
        <div class="modal-footer">
          <button class="btn btn-glass" data-bs-dismiss="modal">Save Changes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- User Delete Modal -->
  <div class="modal fade" id="deleteUserModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content text-center">
        <div class="modal-header">
          <h5>Confirm Delete</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete this user?</p>
        </div>
        <div class="modal-footer justify-content-center">
          <button class="btn btn-danger" data-bs-dismiss="modal">Yes, Delete</button>
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS (keep as-is) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- ===== ONLY SCRIPT CHANGES BELOW ===== -->
  <script>
    // Seed demo data if not present (won't override existing data)
    if (!localStorage.getItem("users")) {
      localStorage.setItem("users", JSON.stringify([
        { id: Date.now(), username: "JohnDoe", email: "john@example.com", status: "Active", activity: "Added Inception to favorites" }
      ]));
    }
    if (!localStorage.getItem("movies")) {
      localStorage.setItem("movies", JSON.stringify([
        { id: Date.now(), title: "The Matrix", poster: "https://via.placeholder.com/60", desc: "What is real?" }
      ]));
    }
    if (!localStorage.getItem("reports")) {
      localStorage.setItem("reports", JSON.stringify([]));
    }
    if (!localStorage.getItem("sessions")) {
      localStorage.setItem("sessions", JSON.stringify([]));
    }

    // ADMIN NAME
    const admin = JSON.parse(localStorage.getItem("activeUser"));
    if (admin) {
      document.getElementById("adminName").textContent = `Welcome, ${admin.name}`;
    }

    // ----------- USERS -----------
    function loadUsers() {
      const users = JSON.parse(localStorage.getItem("users")) || [];
      const usersTable = document.getElementById("usersTable");
      usersTable.innerHTML = "";

      users.forEach((user, i) => {
        usersTable.innerHTML += `
          <tr>
            <td>${i+1}</td>
            <td>${user.username || user.name || ""}</td>
            <td>${user.email || ""}</td>
            <td><span class="badge ${user.status === "Active" ? "bg-success" : "bg-secondary"}">${user.status || (user.isActive ? "Active" : "Suspended")}</span></td>
            <td>
              <button class="btn btn-sm btn-glass" onclick="openEditUser(${i})">Edit</button>
              <button class="btn btn-sm btn-danger" onclick="deleteUser(${i})">Delete</button>
            </td>
          </tr>
        `;
      });

      document.getElementById("userCount").textContent = users.length;
    }

    function openEditUser(index) {
      const users = JSON.parse(localStorage.getItem("users")) || [];
      const user = users[index];
      if (!user) return;

      const modalEl = document.getElementById("editUserModal");
      const usernameInput = modalEl.querySelector('input[type="text"]');
      const emailInput = modalEl.querySelector('input[type="email"]');
      const statusSelect = modalEl.querySelector('select');

      usernameInput.value = user.username || user.name || "";
      emailInput.value = user.email || "";
      // set select value if matches
      if (user.status) statusSelect.value = user.status;
      else statusSelect.value = user.isActive ? "Active" : "Suspended";

      // set save handler (overwrite any previous)
      const saveBtn = modalEl.querySelector('.btn-glass');
      saveBtn.onclick = function() {
        user.username = usernameInput.value.trim();
        user.email = emailInput.value.trim();
        user.status = statusSelect.value;
        // store back
        localStorage.setItem("users", JSON.stringify(users));
        loadUsers();
        // modal will auto-dismiss due to data-bs-dismiss attribute
      };

      // show modal
      new bootstrap.Modal(modalEl).show();
    }

    function deleteUser(index) {
      if (!confirm("Are you sure you want to delete this user?")) return;
      const users = JSON.parse(localStorage.getItem("users")) || [];
      users.splice(index, 1);
      localStorage.setItem("users", JSON.stringify(users));
      loadUsers();
      loadReports(); // reports might reference users
    }

    // ----------- MOVIES -----------
    function loadMovies() {
      const movies = JSON.parse(localStorage.getItem("movies")) || [];
      const moviesTable = document.getElementById("moviesTable");
      moviesTable.innerHTML = "";

      movies.forEach((m, i) => {
        moviesTable.innerHTML += `
          <tr>
            <td>${i+1}</td>
            <td>${m.title}</td>
            <td><img src="${m.poster || 'https://via.placeholder.com/60'}" class="rounded" width="60" /></td>
            <td>
              <button class="btn btn-sm btn-glass" onclick="openEditMovie(${i})">Edit</button>
              <button class="btn btn-sm btn-danger" onclick="deleteMovie(${i})">Delete</button>
            </td>
          </tr>
        `;
      });

      document.getElementById("movieCount").textContent = movies.length;
    }

    function openEditMovie(index) {
      const movies = JSON.parse(localStorage.getItem("movies")) || [];
      const movie = movies[index];
      if (!movie) return;

      const modalEl = document.getElementById("editMovieModal");
      const textInputs = modalEl.querySelectorAll('input[type="text"]'); // [title, poster]
      const descArea = modalEl.querySelector('textarea');

      textInputs[0].value = movie.title || "";
      textInputs[1].value = movie.poster || "";
      descArea.value = movie.desc || "";

      const saveBtn = modalEl.querySelector('.btn-glass');
      saveBtn.onclick = function() {
        movie.title = textInputs[0].value.trim();
        movie.poster = textInputs[1].value.trim();
        movie.desc = descArea.value.trim();
        localStorage.setItem("movies", JSON.stringify(movies));
        loadMovies();
      };

      new bootstrap.Modal(modalEl).show();
    }

    function deleteMovie(index) {
      if (!confirm("Are you sure you want to delete this movie?")) return;
      const movies = JSON.parse(localStorage.getItem("movies")) || [];
      movies.splice(index, 1);
      localStorage.setItem("movies", JSON.stringify(movies));
      loadMovies();
    }

    // ----------- REPORTS -----------
    function loadReports() {
      const reports = JSON.parse(localStorage.getItem("reports")) || [];
      const reportsList = document.getElementById("reportsList");
      reportsList.innerHTML = "";
      if (reports.length === 0) {
        reportsList.innerHTML = "<p>No reports available yet.</p>";
      } else {
        reports.forEach((r, i) => {
          reportsList.innerHTML += `<p><strong>${i+1}.</strong> ${r}</p>`;
        });
      }
      document.getElementById("reportsCount").textContent = reports.length;
    }

    // ----------- SESSIONS (ACTIVE) -----------
    function loadSessions() {
      const sessions = JSON.parse(localStorage.getItem("sessions")) || [];
      document.getElementById("activeSessions").textContent = sessions.length;
    }

    // ----------- INIT & LOGOUT -----------
    function initDashboard() {
      loadUsers();
      loadMovies();
      loadReports();
      loadSessions();
    }

    document.getElementById("logoutBtn").addEventListener("click", () => {
      localStorage.removeItem("activeUser");
      window.location.href = "login.html";
    });

    // initialize
    initDashboard();
  </script>
</body>
</html>
