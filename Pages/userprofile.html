<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Dashboard - Fantasy2Reality</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body, html {
      height: 100%;
      margin: 0;
      font-family: 'Poppins', sans-serif;
      color: #ec1515;
      overflow-x: hidden;
    }
    /* Video background */
    .bg-video {
      position: fixed;
      right: 0;
      bottom: 0;
      min-width: 100%;
      min-height: 100%;
      z-index: -1;
      filter: brightness(0.9);
      object-fit: cover;
    }
    /* Glassmorphism container */
    .glass-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.5);
    }
    /* Hover effect on movie cards */
    .movie-card {
      position: relative;
      overflow: hidden;
      border-radius: 12px;
    }
    .movie-card img {
      width: 100%;
      height: 280px;
      object-fit: cover;
      border-radius: 12px;
      transition: transform 0.3s ease;
    }
    .movie-card:hover img {
      transform: scale(1.1);
    }
    .movie-card .overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0,0,0,0.7);
      color: #4f2929;
      padding: 10px;
      transform: translateY(100%);
      transition: transform 0.3s ease;
    }
    .movie-card:hover .overlay {
      transform: translateY(0);
    }
  </style>
</head>
<body>
  <!-- Background Video -->
  <video autoplay muted loop class="bg-video">
    <source src="../Asset/Videos/100387-video-720.mp4" type="video/mp4">
  </video>

  <!-- Navbar -->
  <nav class="navbar navbar-dark bg-dark bg-opacity-75">
    <div class="container d-flex justify-content-between">
       <a class="navbar-brand" href="#">
                <img src="../Asset/Images/slazzer-preview-8zfsj.png" 
                    width="100" height="70"
                    style="filter: brightness(0) invert(1);">
                </a>
      <button id="logoutBtn" class="btn btn-outline-light btn-sm">Logout</button>
    </div>
  </nav>

  <div class="container py-5">
    <!-- User Welcome -->
    <div class="text-center mb-5 text-light">
      <h1 id="userName">Welcome, User</h1>
      <p id="userEmail">user@email.com</p>
    </div>

    <!-- Stats -->
    <div class="row mb-5 text-center">
      <div class="col-md-4">
        <div class="glass-card border text-light">
          <h3 id="favCount">0</h3>
          <p>Favorites</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="glass-card border text-light">
          <h3 id="addedCount">0</h3>
          <p>Movies Added</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="glass-card border text-light">
          <h3 id="recentCount">0</h3>
          <p>Recently Watched</p>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-4" id="dashboardTabs">
      <li class="nav-item">
        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#searchTab">Search</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#favoritesTab">Favorites</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#addMovieTab">Add Movie</button>
      </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content">
      <!-- Search -->
      <div class="tab-pane fade show active" id="searchTab">
        <div class="input-group mb-4">
          <input type="text" id="searchInput" class="form-control" placeholder="Search for a movie...">
          <button class="btn btn-danger" id="searchBtn">Search</button>
        </div>
        <div id="moviesContainer" class="row g-4">
          <!-- Search results go here -->
        </div>
      </div>

      <!-- Favorites -->
      <div class="tab-pane fade" id="favoritesTab">
        <div id="favoriteMovies" class="row g-4">
          <!-- Favorite movies -->
        </div>
      </div>

      <!-- Add Movie -->
      <div class="tab-pane fade" id="addMovieTab">
        <form id="addMovieForm" class="glass-card">
          <div class="mb-3">
            <input type="text" id="movieTitle" class="form-control" placeholder="Movie Title" required>
          </div>
          <div class="mb-3">
            <input type="text" id="moviePoster" class="form-control" placeholder="Poster URL" required>
          </div>
          <div class="mb-3">
            <textarea id="movieDesc" class="form-control" placeholder="Movie Description" rows="3" required></textarea>
          </div>
          <button type="submit" class="btn btn-danger">Add Movie</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Movie Details Modal -->
  <div class="modal fade" id="movieDetailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content glass-card text-light">
        <div class="modal-header">
          <h5 class="modal-title" id="movieTitleModal">Movie Details</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-md-4 text-center">
              <img id="moviePosterModal" src="" class="img-fluid rounded shadow" alt="Poster">
            </div>
            <div class="col-md-8">
              <p><strong>Year:</strong> <span id="movieYear"></span></p>
              <p><strong>Genre:</strong> <span id="movieGenre"></span></p>
              <p><strong>Director:</strong> <span id="movieDirector"></span></p>
              <p><strong>Actors:</strong> <span id="movieActors"></span></p>
              <p><strong>Plot:</strong> <span id="moviePlot"></span></p>
              <p><strong>IMDB Rating:</strong> ⭐ <span id="movieRating"></span></p>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-light" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Example: Load user data from localStorage
    const user = JSON.parse(localStorage.getItem("activeUser"));
    if (user) {
      document.getElementById("userName").textContent = `Welcome, ${user.name}`;
      document.getElementById("userEmail").textContent = user.email;
    }

    // Logout
    document.getElementById("logoutBtn").addEventListener("click", () => {
      localStorage.removeItem("activeUser");
      window.location.href = "login.html";
    });

    const apiKey = "b4b2c0dc"; 
    const searchBtn = document.getElementById("searchBtn");
    const searchInput = document.getElementById("searchInput");
    const moviesContainer = document.getElementById("moviesContainer");

    // Fetch movies from OMDb API
    async function fetchMovies(query) {
      const url = `https://www.omdbapi.com/?apikey=${apiKey}&s=${query}`;
      const response = await fetch(url);
      const data = await response.json();
      return data.Search || [];
    }

    // Render movies neatly in rows
    function renderMovies(movies) {
      moviesContainer.innerHTML = "";
      movies.forEach(movie => {
        const col = document.createElement("div");
        col.className = "col-md-4 col-lg-3";

        col.innerHTML = `
          <div class="card shadow-sm movie-card">
            <img src="${movie.Poster !== "N/A" ? movie.Poster : 'https://via.placeholder.com/300x450?text=No+Image'}" class="card-img-top movie-poster" alt="${movie.Title}">
            <div class="card-body text-center">
              <h6 class="card-title">${movie.Title}</h6>
              <p class="text-muted">${movie.Year}</p>
              <button class="btn btn-sm btn-outline-danger favorite-btn" data-movie='${JSON.stringify(movie)}'>❤️ Favorite</button>
              <button class="btn btn-sm btn-outline-light details-btn" data-id="${movie.imdbID}">ℹ️ Details</button>
            </div>
          </div>
        `;

        moviesContainer.appendChild(col);
      });

      // Handle favorite button clicks
      document.querySelectorAll(".favorite-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const movie = JSON.parse(btn.getAttribute("data-movie"));
          saveFavorite(movie);
        });
      });

      // Handle details button clicks
      document.querySelectorAll(".details-btn").forEach(btn => {
        btn.addEventListener("click", async () => {
          const imdbID = btn.getAttribute("data-id");
          await showMovieDetails(imdbID);
        });
      });
    }

    // Save favorites to localStorage
    function saveFavorite(movie) {
      let favorites = JSON.parse(localStorage.getItem("favorites")) || [];
      if (!favorites.some(fav => fav.imdbID === movie.imdbID)) {
        favorites.push(movie);
        localStorage.setItem("favorites", JSON.stringify(favorites));
        alert(`${movie.Title} added to Favorites!`);
      } else {
        alert(`${movie.Title} is already in Favorites!`);
      }
    }

    // Show movie details in modal
    async function showMovieDetails(imdbID) {
      const url = `https://www.omdbapi.com/?apikey=${apiKey}&i=${imdbID}&plot=full`;
      const response = await fetch(url);
      const data = await response.json();

      // Populate modal
      document.getElementById("movieTitleModal").textContent = data.Title;
      document.getElementById("moviePosterModal").src = data.Poster !== "N/A" ? data.Poster : 'https://via.placeholder.com/300x450?text=No+Image';
      document.getElementById("movieYear").textContent = data.Year;
      document.getElementById("movieGenre").textContent = data.Genre;
      document.getElementById("movieDirector").textContent = data.Director;
      document.getElementById("movieActors").textContent = data.Actors;
      document.getElementById("moviePlot").textContent = data.Plot;
      document.getElementById("movieRating").textContent = data.imdbRating;

      // Show modal
      const modal = new bootstrap.Modal(document.getElementById("movieDetailsModal"));
      modal.show();
    }

    // Search button click event
    searchBtn.addEventListener("click", async () => {
      const query = searchInput.value.trim();
      if (query) {
        const movies = await fetchMovies(query);
        renderMovies(movies);
      }
    });

    // Search on Enter key press
    searchInput.addEventListener("keypress", async (e) => {
      if (e.key === "Enter") {
        searchBtn.click();
      }
    });
  </script>
</body>
</html>
